---
title: "2025_AFDW_measurements"
author: "Chlo√© Gilligan"
date: "2025-11-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.


# Snail AFDW Data Organization Script

```{r}
library(dplyr)
library(ggplot2)
library(car)
library(lme4)
library(lmerTest)
```



```{r}
file_path <- "~/Desktop/Repositories/Nucella_2025/data/2025_AFDW_sorted_filtered.csv"
afdw <- read.csv(file_path)
afdw_clean <- afdw %>%
  filter(!is.na(Tissue.Mass), !is.na(Shell.Mass))

```

#Setting treatments
```{r}
afdw_clean$Color <- factor(
  afdw_clean$Color,
  levels = c("B", "G", "R", "P"),
  labels = c("Ambient + Crab", "Ambient + No Crab",
             "Heated + Crab", "Heated + No Crab"))
```

```{r}
table(afdw_clean$predation)
table(afdw_clean$temperature)
table(afdw_clean$Color)
```



```{r}
afdw_clean <- afdw_clean %>%
  mutate(
    temperature = ifelse(grepl("Heated", Color), "Heated", "Ambient"),
    predation   = ifelse(grepl("Crab", Color), "Crab", "No Crab")
  )

afdw_clean$temperature <- factor(afdw_clean$temperature)
afdw_clean$predation   <- factor(afdw_clean$predation)

```


#Plotting Tissue Mass
```{r}
ggplot(afdw_clean, aes(x = Color, y = Tissue.Mass, fill = Color)) +
  geom_boxplot() +
  scale_fill_manual(values = c(
    "Ambient + Crab" = "blue",
    "Ambient + No Crab" = "green",
    "Heated + Crab" = "red",
    "Heated + No Crab" = "pink"
  )) +
  theme_bw() +
  labs(
    title = "Tissue Mass by Treatment",
    x = "Treatment",
    y = "Tissue Mass (g)"
  )
```

#Tissue Mass- Stats
```{r}

leveneTest(Tissue.Mass ~ predation * temperature, data = afdw_clean)


m1_ratio_4month <- lmer(Tissue.Mass ~ predation * temperature + (1|site) + (1|batch), 
                        data = afdw_clean, REML=TRUE)

# QQ plot
qqnorm(residuals(m_tissue), main = "QQ Plot - Tissue Mass Model")
qqline(residuals(m_tissue), col = "red", lwd = 2)

Anova(m_tissue, test = "F", type = "III")

```




#Plotting Shell Mass
```{r}
ggplot(afdw_clean, aes(x = Color, y = Shell.Mass, fill = Color)) +
  geom_boxplot() +
  scale_fill_manual(values = c(
    "Ambient + Crab" = "blue",
    "Ambient + No Crab" = "green",
    "Heated + Crab" = "red",
    "Heated + No Crab" = "pink"
  )) +
  theme_bw() +
  labs(
    title = "Shell Mass by Treatment",
    x = "Treatment",
    y = "Shell Mass (g)"
  )
```


#Shell Mass- Stats
```{r}
leveneTest(Shell.Mass ~ predation * temperature, data = afdw_clean)

m_shell <- lmer(Shell.Mass ~ predation * temperature + (1 | batch),
                data = afdw_clean, REML = TRUE)

qqnorm(residuals(m_shell), main = "QQ Plot - Shell Mass Model")
qqline(residuals(m_shell), col = "red", lwd = 2)

Anova(m_shell, test = "F", type = "III")


```






